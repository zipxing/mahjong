{"version":3,"sources":["file:///Users/xinzhou/work/mahjong/star/assets/scripts/InputManager.ts"],"names":["InputManager","Vec3","input","Input","UITransform","ccFind","find","inputInterface","isInputEnabled","isMouseDown","lastClickTime","clickDelay","highlightedBlocks","isHighlightActive","init","setupInputEvents","console","log","on","EventType","TOUCH_START","onTouchStart","TOUCH_END","onTouchEnd","TOUCH_MOVE","onTouchMove","MOUSE_DOWN","onMouseDown","MOUSE_UP","onMouseUp","event","isGameActive","touchPos","getUILocation","x","y","worldPos","uiToWorldPosition","handlePointerDown","handlePointerUp","clearHighlight","mousePos","toFixed","trace","gridPos","screenToGridPosition","row","col","blockData","getBlockAt","type","highlightConnectedBlocks","currentTime","Date","now","onBlockClick","connectedBlocks","findConnectedBlocks","length","startRow","startCol","boardData","getBoardData","boardSize","isValidPosition","targetType","visited","i","Array","fill","queue","push","directions","dr","dc","current","shift","dir","newRow","newCol","uiPos","canvas","error","canvasTransform","getComponent","warn","addComponent","worldX","worldY","designSize","contentSize","width","height","isPortrait","setContentSize","enableInput","disableInput","getHighlightedBlocks","hasHighlight","destroy","off","debugPrintInputState"],"mappings":"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","sourcesContent":["/**\n * ËæìÂÖ•ÁÆ°ÁêÜÂô®\n * Ë¥üË¥£Â§ÑÁêÜËß¶Êë∏ËæìÂÖ•ÂíåÁÇπÂáª‰∫ã‰ª∂\n */\n\nimport { Node, Vec3, input, Input, EventTouch, Camera, UITransform, find as ccFind } from 'cc';\nimport { BlockData } from './BoardManager';\n\nexport interface InputInterface {\n    getBoardData(): BlockData[][];\n    getBlockAt(row: number, col: number): BlockData | null;\n    screenToGridPosition(screenPos: Vec3): {row: number, col: number};\n    onBlockClick(row: number, col: number): void;\n    isGameActive(): boolean;\n}\n\nexport class InputManager {\n    private inputInterface: InputInterface = null!;\n    private isInputEnabled: boolean = true;\n    \n    // Ëß¶Êë∏Áä∂ÊÄÅ\n    private isMouseDown: boolean = false;\n    private lastClickTime: number = 0;\n    private clickDelay: number = 100; // Èò≤Ê≠¢ÈáçÂ§çÁÇπÂáªÁöÑÂª∂ËøüÔºàÊØ´ÁßíÔºâ\n    \n    // È´ò‰∫ÆÁä∂ÊÄÅ\n    private highlightedBlocks: {row: number, col: number}[] = [];\n    private isHighlightActive: boolean = false;\n    \n    /**\n     * ÂàùÂßãÂåñËæìÂÖ•ÁÆ°ÁêÜÂô®\n     */\n    init(inputInterface: InputInterface) {\n        this.inputInterface = inputInterface;\n        this.setupInputEvents();\n        \n        console.log('‚úÖ ËæìÂÖ•ÁÆ°ÁêÜÂô®ÂàùÂßãÂåñÂÆåÊàê');\n    }\n    \n    /**\n     * ËÆæÁΩÆËæìÂÖ•‰∫ã‰ª∂ÁõëÂê¨\n     */\n    private setupInputEvents() {\n        // ÁõëÂê¨Ëß¶Êë∏ÂºÄÂßã\n        input.on(Input.EventType.TOUCH_START, this.onTouchStart, this);\n        \n        // ÁõëÂê¨Ëß¶Êë∏ÁªìÊùü\n        input.on(Input.EventType.TOUCH_END, this.onTouchEnd, this);\n        \n        // ÁõëÂê¨Ëß¶Êë∏ÁßªÂä®ÔºàÁî®‰∫éÂèñÊ∂àÈ´ò‰∫ÆÔºâ\n        input.on(Input.EventType.TOUCH_MOVE, this.onTouchMove, this);\n        \n        // ÁõëÂê¨Èº†Ê†áÁÇπÂáªÔºàÁî®‰∫éÊ°åÈù¢Á´ØÔºâ\n        input.on(Input.EventType.MOUSE_DOWN, this.onMouseDown, this);\n        input.on(Input.EventType.MOUSE_UP, this.onMouseUp, this);\n        \n        console.log('üéÆ ËæìÂÖ•‰∫ã‰ª∂ÁõëÂê¨Â∑≤ËÆæÁΩÆ');\n    }\n    \n    /**\n     * Ëß¶Êë∏ÂºÄÂßã‰∫ã‰ª∂\n     */\n    private onTouchStart(event: EventTouch) {\n        if (!this.isInputEnabled || !this.inputInterface.isGameActive()) {\n            return;\n        }\n        \n        this.isMouseDown = true;\n        \n        const touchPos = event.getUILocation();\n        console.log(`üì± Ëß¶Êë∏UIÂùêÊ†á: (${touchPos.x}, ${touchPos.y})`);\n        \n        // Â∞ÜUIÂùêÊ†áËΩ¨Êç¢‰∏∫‰∏ñÁïåÂùêÊ†á\n        const worldPos = this.uiToWorldPosition(touchPos);\n        console.log(`üåç ËΩ¨Êç¢Âêé‰∏ñÁïåÂùêÊ†á: (${worldPos.x}, ${worldPos.y})`);\n        \n        this.handlePointerDown(worldPos);\n    }\n    \n    /**\n     * Ëß¶Êë∏ÁªìÊùü‰∫ã‰ª∂\n     */\n    private onTouchEnd(event: EventTouch) {\n        if (!this.isInputEnabled || !this.inputInterface.isGameActive()) {\n            return;\n        }\n        \n        this.isMouseDown = false;\n        \n        const touchPos = event.getUILocation();\n        console.log(`üì± Ëß¶Êë∏UIÂùêÊ†á: (${touchPos.x}, ${touchPos.y})`);\n        \n        // Â∞ÜUIÂùêÊ†áËΩ¨Êç¢‰∏∫‰∏ñÁïåÂùêÊ†á\n        const worldPos = this.uiToWorldPosition(touchPos);\n        console.log(`üåç ËΩ¨Êç¢Âêé‰∏ñÁïåÂùêÊ†á: (${worldPos.x}, ${worldPos.y})`);\n        \n        this.handlePointerUp(worldPos);\n    }\n    \n    /**\n     * Ëß¶Êë∏ÁßªÂä®‰∫ã‰ª∂\n     */\n    private onTouchMove(event: EventTouch) {\n        if (!this.isInputEnabled || !this.inputInterface.isGameActive() || !this.isMouseDown) {\n            return;\n        }\n        \n        // Â¶ÇÊûúÊ≠£Âú®ÊãñÊãΩÔºåÊ∏ÖÈô§È´ò‰∫Æ\n        this.clearHighlight();\n    }\n    \n    /**\n     * Èº†Ê†áÊåâ‰∏ã‰∫ã‰ª∂\n     */\n    private onMouseDown(event: EventTouch) {\n        if (!this.isInputEnabled || !this.inputInterface.isGameActive()) {\n            return;\n        }\n        \n        this.isMouseDown = true;\n        \n        const mousePos = event.getUILocation();\n        console.log(`üñ±Ô∏è Èº†Ê†áUIÂùêÊ†á: (${mousePos.x}, ${mousePos.y})`);\n        \n        // Â∞ÜUIÂùêÊ†áËΩ¨Êç¢‰∏∫‰∏ñÁïåÂùêÊ†á\n        const worldPos = this.uiToWorldPosition(mousePos);\n        console.log(`üåç ËΩ¨Êç¢Âêé‰∏ñÁïåÂùêÊ†á: (${worldPos.x}, ${worldPos.y})`);\n        \n        this.handlePointerDown(worldPos);\n    }\n    \n    /**\n     * Èº†Ê†áÈáäÊîæ‰∫ã‰ª∂\n     */\n    private onMouseUp(event: EventTouch) {\n        if (!this.isInputEnabled || !this.inputInterface.isGameActive()) {\n            return;\n        }\n        \n        this.isMouseDown = false;\n        \n        const mousePos = event.getUILocation();\n        console.log(`üñ±Ô∏è Èº†Ê†áUIÂùêÊ†á: (${mousePos.x}, ${mousePos.y})`);\n        \n        // Â∞ÜUIÂùêÊ†áËΩ¨Êç¢‰∏∫‰∏ñÁïåÂùêÊ†á\n        const worldPos = this.uiToWorldPosition(mousePos);\n        console.log(`üåç ËΩ¨Êç¢Âêé‰∏ñÁïåÂùêÊ†á: (${worldPos.x}, ${worldPos.y})`);\n        \n        this.handlePointerUp(worldPos);\n    }\n    \n    /**\n     * Â§ÑÁêÜÊåáÈíàÊåâ‰∏ã\n     */\n    private handlePointerDown(worldPos: Vec3) {\n        console.log(`\\nüëÜ ===== ÊåáÈíàÊåâ‰∏ã‰∫ã‰ª∂ =====`);\n        console.log(`üìç ‰∏ñÁïåÂùêÊ†á: (${worldPos.x.toFixed(1)}, ${worldPos.y.toFixed(1)})`);\n        console.log(`üîç Ë∞ÉÁî®Êù•Ê∫êË∑üË∏™:`);\n        console.trace();\n        \n        const gridPos = this.inputInterface.screenToGridPosition(worldPos);\n        console.log(`üéØ ÁΩëÊ†ºÂùêÊ†á: (${gridPos.row}, ${gridPos.col})`);\n        \n        const blockData = this.inputInterface.getBlockAt(gridPos.row, gridPos.col);\n        console.log(`üì¶ ÊñπÂùóÊï∞ÊçÆ:`, blockData);\n        \n        if (blockData && blockData.type !== -1) {\n            console.log(`üëÜ Êåâ‰∏ãÊñπÂùó: (${gridPos.row}, ${gridPos.col}), Á±ªÂûã: ${blockData.type}`);\n            \n            // È´ò‰∫ÆËøûÈÄöÂå∫Âüü‰Ωú‰∏∫È¢ÑËßà\n            this.highlightConnectedBlocks(gridPos.row, gridPos.col);\n        } else {\n            console.log(`‚ùå Êåâ‰∏ã‰∫ÜÁ©∫‰ΩçÁΩÆÊàñÊó†Êïà‰ΩçÁΩÆ`);\n        }\n        console.log(`üëÜ ===== ÊåáÈíàÊåâ‰∏ã‰∫ã‰ª∂ÁªìÊùü =====\\n`);\n    }\n    \n    /**\n     * Â§ÑÁêÜÊåáÈíàÈáäÊîæ\n     */\n    private handlePointerUp(worldPos: Vec3) {\n        console.log(`\\nüëÜ ===== ÊåáÈíàÈáäÊîæ‰∫ã‰ª∂ =====`);\n        console.log(`üìç ‰∏ñÁïåÂùêÊ†á: (${worldPos.x.toFixed(1)}, ${worldPos.y.toFixed(1)})`);\n        \n        // Èò≤Ê≠¢ÈáçÂ§çÁÇπÂáª\n        const currentTime = Date.now();\n        console.log(`‚è∞ ÂΩìÂâçÊó∂Èó¥: ${currentTime}, ‰∏äÊ¨°ÁÇπÂáª: ${this.lastClickTime}, Èó¥Èöî: ${currentTime - this.lastClickTime}ms`);\n        \n        if (currentTime - this.lastClickTime < this.clickDelay) {\n            console.log(`‚ùå ÁÇπÂáªÈó¥ÈöîÂ§™Áü≠ÔºåÂøΩÁï•Ê≠§Ê¨°ÁÇπÂáª (< ${this.clickDelay}ms)`);\n            return;\n        }\n        this.lastClickTime = currentTime;\n        \n        const gridPos = this.inputInterface.screenToGridPosition(worldPos);\n        console.log(`üéØ ÁΩëÊ†ºÂùêÊ†á: (${gridPos.row}, ${gridPos.col})`);\n        \n        const blockData = this.inputInterface.getBlockAt(gridPos.row, gridPos.col);\n        console.log(`üì¶ ÊñπÂùóÊï∞ÊçÆ:`, blockData);\n        \n        if (blockData && blockData.type !== -1) {\n            console.log(`üëÜ Á°ÆËÆ§ÁÇπÂáªÊñπÂùó: (${gridPos.row}, ${gridPos.col}), Á±ªÂûã: ${blockData.type}`);\n            \n            // Ê∏ÖÈô§È´ò‰∫Æ\n            this.clearHighlight();\n            \n            // ÊâßË°åÁÇπÂáªÂõûË∞É\n            console.log(`üîÑ Ë∞ÉÁî®Ê∏∏ÊàèÈÄªËæëÂ§ÑÁêÜÁÇπÂáª...`);\n            this.inputInterface.onBlockClick(gridPos.row, gridPos.col);\n        } else {\n            console.log(`üëÜ ÁÇπÂáªÁ©∫‰Ωç: (${gridPos.row}, ${gridPos.col})`);\n            this.clearHighlight();\n        }\n        console.log(`üëÜ ===== ÊåáÈíàÈáäÊîæ‰∫ã‰ª∂ÁªìÊùü =====\\n`);\n    }\n    \n    /**\n     * È´ò‰∫ÆËøûÈÄöÁöÑÊñπÂùó\n     */\n    private highlightConnectedBlocks(row: number, col: number) {\n        // Ê∏ÖÈô§‰πãÂâçÁöÑÈ´ò‰∫Æ\n        this.clearHighlight();\n        \n        // Ëé∑ÂèñËøûÈÄöÂå∫ÂüüÔºàÁÆÄÂåñÁâàÔºåÂÆûÈôÖÂ∫îËØ•Ë∞ÉÁî®EliminationManagerÔºâ\n        const connectedBlocks = this.findConnectedBlocks(row, col);\n        \n        if (connectedBlocks.length >= 2) {\n            this.highlightedBlocks = connectedBlocks;\n            this.isHighlightActive = true;\n            \n            // ÂÆûÈôÖÁöÑÈ´ò‰∫ÆÈÄªËæëÂ∫îËØ•ÈÄöËøáÂõûË∞ÉÊé•Âè£ÂÆûÁé∞\n            console.log(`‚ú® È´ò‰∫Æ ${connectedBlocks.length} ‰∏™ËøûÈÄöÊñπÂùó`);\n        }\n    }\n    \n    /**\n     * ÁÆÄÂåñÁâàËøûÈÄöÂå∫ÂüüÊü•ÊâæÔºàÂÆûÈôÖÂ∫îËØ•ÂßîÊâòÁªôEliminationManagerÔºâ\n     */\n    private findConnectedBlocks(startRow: number, startCol: number): {row: number, col: number}[] {\n        const boardData = this.inputInterface.getBoardData();\n        const boardSize = boardData.length;\n        \n        if (!this.isValidPosition(startRow, startCol, boardSize) || \n            boardData[startRow][startCol].type === -1) {\n            return [];\n        }\n        \n        const targetType = boardData[startRow][startCol].type;\n        const visited: boolean[][] = [];\n        const connectedBlocks: {row: number, col: number}[] = [];\n        \n        // ÂàùÂßãÂåñËÆøÈóÆÊ†áËÆ∞\n        for (let i = 0; i < boardSize; i++) {\n            visited[i] = new Array(boardSize).fill(false);\n        }\n        \n        // BFSÈòüÂàó\n        const queue: {row: number, col: number}[] = [{row: startRow, col: startCol}];\n        visited[startRow][startCol] = true;\n        connectedBlocks.push({row: startRow, col: startCol});\n        \n        // Âõõ‰∏™ÊñπÂêë\n        const directions = [\n            {dr: -1, dc: 0},  // ‰∏ä\n            {dr: 1, dc: 0},   // ‰∏ã\n            {dr: 0, dc: -1},  // Â∑¶\n            {dr: 0, dc: 1}    // Âè≥\n        ];\n        \n        while (queue.length > 0) {\n            const current = queue.shift()!;\n            \n            for (const dir of directions) {\n                const newRow = current.row + dir.dr;\n                const newCol = current.col + dir.dc;\n                \n                if (!this.isValidPosition(newRow, newCol, boardSize) ||\n                    visited[newRow][newCol] ||\n                    boardData[newRow][newCol].type !== targetType) {\n                    continue;\n                }\n                \n                visited[newRow][newCol] = true;\n                queue.push({row: newRow, col: newCol});\n                connectedBlocks.push({row: newRow, col: newCol});\n            }\n        }\n        \n        return connectedBlocks;\n    }\n    \n    /**\n     * Ê£ÄÊü•‰ΩçÁΩÆÊòØÂê¶ÊúâÊïà\n     */\n    private isValidPosition(row: number, col: number, boardSize: number): boolean {\n        return row >= 0 && row < boardSize && col >= 0 && col < boardSize;\n    }\n    \n    /**\n     * Ê∏ÖÈô§È´ò‰∫ÆÊòæÁ§∫\n     */\n    private clearHighlight() {\n        if (this.isHighlightActive) {\n            console.log('üßπ Ê∏ÖÈô§ÊñπÂùóÈ´ò‰∫Æ');\n            this.highlightedBlocks = [];\n            this.isHighlightActive = false;\n        }\n    }\n    \n    /**\n     * UIÂùêÊ†áËΩ¨Êç¢‰∏∫‰∏ñÁïåÂùêÊ†á\n     */\n    private uiToWorldPosition(uiPos: {x: number, y: number}): Vec3 {\n        // Ëé∑ÂèñCanvasËäÇÁÇπ\n        const canvas = ccFind('Canvas');\n        if (!canvas) {\n            console.error('‚ùå Êâæ‰∏çÂà∞CanvasËäÇÁÇπ');\n            return new Vec3(uiPos.x, uiPos.y, 0);\n        }\n        \n        // Ëé∑ÂèñCanvasÁöÑUITransform\n        let canvasTransform = canvas.getComponent(UITransform);\n        if (!canvasTransform) {\n            console.warn('‚ö†Ô∏è CanvasÊ≤°ÊúâUITransformÁªÑ‰ª∂ÔºåÂ∞ùËØïÊ∑ªÂä†...');\n            canvasTransform = canvas.addComponent(UITransform);\n            if (!canvasTransform) {\n                console.error('‚ùå Êó†Ê≥ï‰∏∫CanvasÊ∑ªÂä†UITransformÁªÑ‰ª∂Ôºå‰ΩøÁî®ÈªòËÆ§ÂùêÊ†áËΩ¨Êç¢');\n                // ‰ΩøÁî®Á´ñÂ±èÂ∞∫ÂØ∏‰Ωú‰∏∫ÂêéÂ§áÊñπÊ°à\n                const worldX = uiPos.x - 360;  // ÂÅáËÆæ720ÂÆΩÂ∫¶Ôºå‰∏≠ÂøÉ‰∏∫360\n                const worldY = (1280 - uiPos.y) - 640;  // ÂÅáËÆæ1280È´òÂ∫¶ÔºåYËΩ¥ÁøªËΩ¨Ôºå‰∏≠ÂøÉ‰∏∫640\n                console.log(`üîÑ ÈªòËÆ§ÂùêÊ†áËΩ¨Êç¢(Á´ñÂ±è): UI(${uiPos.x}, ${uiPos.y}) -> World(${worldX}, ${worldY})`);\n                return new Vec3(worldX, worldY, 0);\n            }\n        }\n        \n        // Ê£ÄÊü•CanvasÂ∞∫ÂØ∏Ôºå‰ΩÜ‰ºòÂÖà‰ΩøÁî®ÁºñËæëÂô®ËÆæÁΩÆ\n        let designSize = canvasTransform.contentSize;\n        console.log(`üìê ÂΩìÂâçCanvasÂ∞∫ÂØ∏: ${designSize.width} x ${designSize.height}`);\n        \n        // Âà§Êñ≠Â±èÂπïÊñπÂêë\n        const isPortrait = designSize.height > designSize.width;\n        console.log(`üì± Â±èÂπïÊñπÂêë: ${isPortrait ? 'Á´ñÂ±è' : 'Ê®™Â±è'}`);\n        \n        if (designSize.width === 100 && designSize.height === 100) {\n            // Âè™ÊúâÂú®ÈªòËÆ§Â∞∫ÂØ∏Êó∂ÊâçËá™Âä®ËÆæÁΩÆÔºåÊé®ËçêÂú®ÁºñËæëÂô®‰∏≠ÊâãÂä®ËÆæÁΩÆ\n            console.log('üîß Ê£ÄÊµãÂà∞ÈªòËÆ§Â∞∫ÂØ∏ÔºåÂª∫ËÆÆÂú®ÁºñËæëÂô®‰∏≠ËÆæÁΩÆCanvas‰∏∫720x1280');\n            console.log('üìù ‰∏¥Êó∂ËÆæÁΩÆ‰∏∫Á´ñÂ±èÂàÜËæ®Áéá...');\n            canvasTransform.setContentSize(720, 1280);  // Á´ñÂ±èÔºöÂÆΩ720ÔºåÈ´ò1280\n            designSize = canvasTransform.contentSize;  // ÈáçÊñ∞Ëé∑ÂèñÊõ¥Êñ∞ÂêéÁöÑÂ∞∫ÂØ∏\n            console.log('‚úÖ CanvasÂ∞∫ÂØ∏Â∑≤‰∏¥Êó∂ËÆæÁΩÆ‰∏∫ 720 x 1280 (Á´ñÂ±è)');\n        }\n        \n        console.log(`üìê ÊúÄÁªàCanvasËÆæËÆ°Â∞∫ÂØ∏: ${designSize.width} x ${designSize.height}`);\n        \n        // Â∞ÜUIÂùêÊ†áËΩ¨Êç¢‰∏∫‰∏ñÁïåÂùêÊ†áÔºàÁõ∏ÂØπ‰∫éCanvas‰∏≠ÂøÉÔºâ\n        // Ê≥®ÊÑèÔºöCocos CreatorÁöÑUIÂùêÊ†áÂéüÁÇπÂú®Â∑¶‰∏ãËßíÔºå‰∏ñÁïåÂùêÊ†á‰∏≠ÂøÉÂú®Canvas‰∏≠ÂøÉ\n        // ‰ΩÜÊòØÈº†Ê†á/Ëß¶Êë∏ÂùêÊ†áÂèØËÉΩÊòØ‰ªéÂ∑¶‰∏äËßíÂºÄÂßãÁöÑÔºåÈúÄË¶ÅYËΩ¥ÁøªËΩ¨\n        const worldX = uiPos.x - designSize.width / 2;\n        \n        // Ê£ÄÊü•YËΩ¥ÊñπÂêëÔºöÂ¶ÇÊûúUIÂùêÊ†áÂæàÂ§ßÔºàÊé•ËøëÂ±èÂπïÈ´òÂ∫¶ÔºâÔºåËØ¥ÊòéÊòØ‰ªé‰∏äÂà∞‰∏ãÁöÑÂùêÊ†áÁ≥ª\n        let worldY;\n        if (uiPos.y > designSize.height * 0.5) {\n            // ÂèØËÉΩÊòØ‰ªéÂ∑¶‰∏äËßíÂºÄÂßãÁöÑÂùêÊ†áÁ≥ªÔºåÈúÄË¶ÅYËΩ¥ÁøªËΩ¨\n            worldY = (designSize.height - uiPos.y) - designSize.height / 2;\n            console.log(`üîÑ YËΩ¥ÁøªËΩ¨Ê®°Âºè: UI_Y=${uiPos.y} -> Flipped_Y=${designSize.height - uiPos.y} -> World_Y=${worldY.toFixed(1)}`);\n        } else {\n            // Ê≠£Â∏∏ÁöÑ‰ªéÂ∑¶‰∏ãËßíÂºÄÂßãÁöÑÂùêÊ†áÁ≥ª\n            worldY = uiPos.y - designSize.height / 2;\n            console.log(`üîÑ YËΩ¥Ê≠£Â∏∏Ê®°Âºè: UI_Y=${uiPos.y} -> World_Y=${worldY.toFixed(1)}`);\n        }\n        \n        console.log(`üîÑ ÊúÄÁªàÂùêÊ†áËΩ¨Êç¢: UI(${uiPos.x}, ${uiPos.y}) -> World(${worldX}, ${worldY})`);\n        \n        return new Vec3(worldX, worldY, 0);\n    }\n    \n    /**\n     * ÂêØÁî®ËæìÂÖ•\n     */\n    enableInput() {\n        this.isInputEnabled = true;\n        console.log('‚úÖ ËæìÂÖ•Â∑≤ÂêØÁî®');\n    }\n    \n    /**\n     * Á¶ÅÁî®ËæìÂÖ•\n     */\n    disableInput() {\n        this.isInputEnabled = false;\n        this.clearHighlight();\n        console.log('‚ùå ËæìÂÖ•Â∑≤Á¶ÅÁî®');\n    }\n    \n    /**\n     * Ëé∑ÂèñÂΩìÂâçÈ´ò‰∫ÆÁöÑÊñπÂùó\n     */\n    getHighlightedBlocks(): {row: number, col: number}[] {\n        return [...this.highlightedBlocks];\n    }\n    \n    /**\n     * Ê£ÄÊü•ÊòØÂê¶ÊúâÈ´ò‰∫ÆÊòæÁ§∫\n     */\n    hasHighlight(): boolean {\n        return this.isHighlightActive;\n    }\n    \n    /**\n     * ÈîÄÊØÅËæìÂÖ•ÁÆ°ÁêÜÂô®\n     */\n    destroy() {\n        // ÁßªÈô§‰∫ã‰ª∂ÁõëÂê¨\n        input.off(Input.EventType.TOUCH_START, this.onTouchStart, this);\n        input.off(Input.EventType.TOUCH_END, this.onTouchEnd, this);\n        input.off(Input.EventType.TOUCH_MOVE, this.onTouchMove, this);\n        input.off(Input.EventType.MOUSE_DOWN, this.onMouseDown, this);\n        input.off(Input.EventType.MOUSE_UP, this.onMouseUp, this);\n        \n        // Ê∏ÖÈô§Áä∂ÊÄÅ\n        this.clearHighlight();\n        \n        console.log('üóëÔ∏è ËæìÂÖ•ÁÆ°ÁêÜÂô®Â∑≤ÈîÄÊØÅ');\n    }\n    \n    /**\n     * Ë∞ÉËØïÔºöÊâìÂç∞ËæìÂÖ•Áä∂ÊÄÅ\n     */\n    debugPrintInputState() {\n        console.log('üéÆ ËæìÂÖ•Áä∂ÊÄÅ:');\n        console.log(`  ËæìÂÖ•ÂêØÁî®: ${this.isInputEnabled}`);\n        console.log(`  Èº†Ê†áÊåâ‰∏ã: ${this.isMouseDown}`);\n        console.log(`  È´ò‰∫ÆÊøÄÊ¥ª: ${this.isHighlightActive}`);\n        console.log(`  È´ò‰∫ÆÊñπÂùóÊï∞: ${this.highlightedBlocks.length}`);\n    }\n}\n"]}